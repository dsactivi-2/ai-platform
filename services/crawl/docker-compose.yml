services:
  # RabbitMQ Message Queue
  # rabbitmq:
  #   image: rabbitmq:3-management-alpine
  #   container_name: crawler_rabbitmq
  #   restart: unless-stopped
  #   ports:
  #     - "5672:5672"    # AMQP port
  #     - "15672:15672"  # Management UI port
  #   environment:
  #     RABBITMQ_DEFAULT_USER: crawler
  #     RABBITMQ_DEFAULT_PASS: crawler123
  #     RABBITMQ_DEFAULT_VHOST: /
  #   volumes:
  #     - rabbitmq_data:/var/lib/rabbitmq
  #     - ./rabbitmq.conf:/etc/rabbitmq/rabbitmq.conf:ro
  #   networks:
  #     - crawler_network
  #   healthcheck:
  #     test: rabbitmq-diagnostics -q ping
  #     interval: 30s
  #     timeout: 30s
  #     retries: 3

  # Web Crawler API
  crawler-api:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: crawler_api
    restart: unless-stopped
    ports:
      - "8080:8080"
    environment:
      - MONGO_URI=${MONGO_URI:-mongodb://localhost:27017/crawler}
      - RABBITMQ_URL=${RABBITMQ_URL:-}
      - PORT=8080
      - GIN_MODE=release
      - API_KEY=${API_KEY:-your-secure-api-key-here}
    # depends_on:
    #   rabbitmq:
    #     condition: service_healthy
    networks:
      - crawler_network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

volumes:
  rabbitmq_data:
    driver: local

networks:
  crawler_network:
    driver: bridge